@model IEnumerable<websample.Models.users>

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.kana)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.tel)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.password)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.name)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.kana)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.tel)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.password)
        </td>
        <td>
            <button class="toolbtn btn_green" id="edit" code="@item.id">編集する</button>
            @Html.ActionLink("Edit", "Edit", new { id=item.id }) |
            @Html.ActionLink("Details", "Details", new { id=item.id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.id })
        </td>
    </tr>
}

</table>

<button class="toolbtn btn_green" id="test"><i class="icon-plus icon-white"></i>追加する</button>

<div id="edit_dlg" title="" style="display:none">
    <p class="summary">入力してください</p>
    <table>
        <tr>
            <td class="td-r">名前</td>
            <td><input type="text" id="name" maxlength="30"></td>
        </tr>
        <tr>
            <td class="td-r">カナ</td>
            <td><input type="text" id="kana" maxlength="30"></td>
        </tr>
        <tr>
            <td class="td-r">電話</td>
            <td><input type="text" id="tel" maxlength="100"></td>
        </tr>
        <tr>
            <td class="td-r">パスワード</td>
            <td><input type="text" id="password" maxlength="100"></td>
        </tr>
    </table>
</div>

@section scripts {
<script type="text/javascript">
    $(function () {
        $('#test').click(function () {
            alertDlg("hello", "hogehoge");
        });


        $(document).on("click", '#edit', function () {
            //        alertDlg("edit", $(this).attr('code'));

            var code = $(this).attr('code');
            var param = {
                id: code,
                cmd: 'SELECT'
            };

            DbAccess('', '/api/api/', param,
                function (ret) {
                    $('#edit_dlg #name').val(ret['name']);
                    $('#edit_dlg #kana').val(ret['kana']);
                    $('#edit_dlg #tel').val(ret['tel']);
                    $('#edit_dlg #password').val(ret['password']);
                    //                $('#edit_dlg').dialog("destroy");
                },
                function (ret) {
                    /*                if (ret['info']['1'] == "1062") {
                        alertDlg("エラー", "コードが重複しています");
                    }
                    else {
                        alertDlg("エラー", ret['info']);
                    }
    */
                }
            );

            $("#edit_dlg").dialog({
                title: 'ユーザー情報変更',
                autoOpen: true,
                modal: true,
                width: 500,
                height: 300,
                buttons: {
                    "OK": function () {

                        var param = {
                            id: code,
                            cmd: 'UPDATE',
                            name: $('#edit_dlg #name').val(),
                            kana: $('#edit_dlg #kana').val(),
                            tel: $('#edit_dlg #tel').val(),
                            password: $('#edit_dlg #password').val(),
                        };

                        DbAccess('', '/api/api/', param,
                            function (ret) {
                                $('#edit_dlg').dialog("destroy");
                                //                            updateBusList();
                            },
                            function (ret) {
                                if (ret['info']['1'] == "1062") {
                                    alertDlg("エラー", "コードが重複しています");
                                }
                                else {
                                    alertDlg("エラー", ret['info']);
                                }
                            }
                        );
                    },
                    "削除": function () {
                        $(this).dialog("destroy");
                        deleteBus(
                                old_code,
                                $('#bus_dlg #name').val());
                    },
                    "キャンセル": function () {
                        $(this).dialog("destroy");
                    },
                }
            });
        });

    })


 </script>

}